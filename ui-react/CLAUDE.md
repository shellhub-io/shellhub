# ui-react — ShellHub React UI

## Overview

New React-based UI for ShellHub, served at `/v2/` alongside the legacy Vue UI at `/`. Part of a monorepo with Go backend services.

## Development

### Running locally (within the monorepo)

```bash
# From monorepo root — starts all services including ui-react with hot reload
make start ARGS="SHELLHUB_ENV=development"

# Or with docker-compose directly
docker compose -f docker-compose.yml -f docker-compose.dev.yml up
```

The dev container mounts `./ui-react:/src` and runs Vite with HMR on port 8080. Access via gateway at `http://localhost/v2/`.

### TypeScript check

```bash
cd ui-react && npx tsc --noEmit
```

### Build

```bash
cd ui-react && npm run build
```

## Architecture

### Stack

- **Vite 5** — bundler, dev server, HMR
- **React 18** — UI framework
- **TypeScript** — strict mode enabled
- **React Router v6** — client-side routing, `BrowserRouter` with `basename="/v2"`
- **Zustand** — state management (no boilerplate, no providers)
- **Axios** — HTTP client with interceptors for auth
- **TailwindCSS 3** — utility-first styling
- **xterm.js** — terminal emulation (WebGL renderer)

### Project structure

```
ui-react/
├── src/
│   ├── api/           # Axios API functions (one file per resource)
│   ├── components/
│   │   ├── common/    # Reusable: PageHeader, StatCard, WelcomeScreen, etc.
│   │   ├── layout/    # AppLayout, Sidebar, AppBar, UserMenu, etc.
│   │   └── terminal/  # TerminalManager, TerminalInstance, TerminalTaskbar
│   ├── pages/         # Route components: Dashboard, Devices, Sessions, etc.
│   ├── stores/        # Zustand stores (one file per domain)
│   ├── types/         # TypeScript interfaces (one file per resource)
│   ├── env.ts         # Environment variable access
│   ├── App.tsx        # Route definitions
│   └── main.tsx       # Entry point
├── tailwind.config.js
├── vite.config.ts
├── tsconfig.json      # Source TypeScript config
└── tsconfig.node.json # Vite config TypeScript (composite + emitDeclarationOnly)
```

### Key patterns

**API layer** — Each resource has an `api/<resource>.ts` file with plain async functions. They use `apiClient` from `api/client.ts` (Axios instance with base URL auto-detected from `window.location`). Auth token is injected via interceptors.

**Stores** — Zustand stores in `stores/<domain>Store.ts`. Each store manages its own API calls and state. Stores are independent (no cross-store dependencies). Components call store hooks directly.

**Types** — Shared interfaces in `types/<resource>.ts`. Used by both API functions and components.

**Routes** — Defined in `App.tsx`. Protected routes wrapped in `<ProtectedRoute>` → `<NamespaceGuard>` → `<AppLayout>`.

**Session sharing** — Shares `localStorage` keys (`token`, `user`, `tenant`) with the Vue UI so users stay logged in across both UIs.

**Runtime config** — `env.ts` fetches `/v2/ui/config.json` at startup (generated by `gen-config.sh` from container env vars). In production, nginx serves the file; in dev, Vite serves it from `apps/admin/public/`. Access via `getConfig()` (sync) after `loadConfig()` (async, called once in `main.tsx`).

### Design system

Dark theme only. Colors defined in `tailwind.config.js`:

| Token | Value | Usage |
|-------|-------|-------|
| `background` | `#18191B` | Page background |
| `surface` | `#1E2127` | Cards, panels, AppBar |
| `card` | `#22252B` | Elevated cards |
| `border` | `#2C2F36` | Borders, dividers |
| `border-light` | `#383D47` | Hover borders |
| `text-primary` | `#E1E4EA` | Main text |
| `text-secondary` | `#8B8F99` | Secondary text |
| `text-muted` | `#81879C` | Disabled/muted text |
| `primary` | `#667ACC` | Primary actions, links |
| `accent-green` | `#82a568` | Online, success |
| `accent-red` | `#D8737B` | Errors, destructive |
| `accent-yellow` | `#bf8c5d` | Warnings, pending |
| `accent-blue` | `#56a2e1` | Info |
| `accent-cyan` | `#4e9aa3` | Secondary info |

**Typography**: IBM Plex Sans (body), IBM Plex Mono (code/technical data). Custom `text-2xs` size (0.625rem).

**Animations**: Defined in both `tailwind.config.js` (component-level: fade-in, slide-up, slide-down, pulse-subtle) and `index.css` (page-enter transition, connection animations, shimmer).

### Component conventions

- Inline SVG icons (no icon library). Heroicons style: `w-5 h-5`, `fill="none"`, `stroke="currentColor"`, `strokeWidth={1.5}`.
- Click-outside pattern: `useRef` + `mousedown` event listener for dropdowns.
- Page headers use `PageHeader` or `PageHeaderV2` components.
- Empty states use `WelcomeScreen` component.
- Feature gates use `FeatureGate` component (enterprise/cloud features).

### TypeScript config notes

- `tsconfig.json` (src): `noEmit: true`, strict, project references to `tsconfig.node.json`
- `tsconfig.node.json` (vite config): `composite: true` + `emitDeclarationOnly: true` (NOT `noEmit` — conflicts with `composite`)
- `@types/node` needed for vite.config.ts (`path`, `__dirname`, `process`)
- Path alias: `@/*` maps to `src/*`

### Gateway routing

The nginx gateway routes `/v2/` to the ui-react service. Config is in `gateway/nginx/conf.d/shellhub.conf` (Go template). In dev, Vite handles the routing; in prod, nginx serves static files with SPA fallback.

## Common tasks

### Adding a new page

1. Create `src/pages/MyPage.tsx`
2. Add route in `src/App.tsx` inside the `<AppLayout>` route group
3. Add sidebar link in `src/components/layout/Sidebar.tsx`

### Adding a new API resource

1. Create type in `src/types/<resource>.ts`
2. Create API functions in `src/api/<resource>.ts`
3. Create Zustand store in `src/stores/<resource>Store.ts` (if needed)

### Adding new Tailwind animations

Prefer defining animations in `src/index.css` (HMR picks them up immediately) over `tailwind.config.js` (requires dev server restart for changes to take effect).
