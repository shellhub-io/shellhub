#!/bin/sh

UI_DIR="ui"
FRONTEND_PATH="$(git rev-parse --show-toplevel)/$UI_DIR"

echo "ğŸ” Running pre-push checks in /ui..."

FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep "^$UI_DIR/")

if [ -z "$FILES" ]; then
  echo "No files to check. Skipping ESLint and Vitest."
  exit 0
fi

cd "$FRONTEND_PATH" || { echo "âŒ Failed to change to /ui"; exit 1; }

RELATIVE_FILES=$(echo "$FILES" | sed "s|^$UI_DIR/||")

echo "ğŸ” Running ESLint..."
npx eslint $RELATIVE_FILES || { 
    echo "âŒ ESLint failed! Fix the issues before committing."
    exit 1
}

echo "ğŸ§ª Running the tests..."
npx vitest run || {
  echo "âŒ Tests failed! Fix the failing tests before committing."
  exit 1
}

echo "âœ… Pre-push checks passed!"
exit 0