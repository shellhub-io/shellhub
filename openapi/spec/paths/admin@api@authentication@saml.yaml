put:
  operationId: configureSAMLAuthentication
  summary: Configure SAML Authentication
  description: |
    Configure SAML authentication settings for the ShellHub instance.

    The NameID in the SAML assertion from the IdP must be configured to use
    a format that provides a unique and persistent identifier for each user. This could be
    a persistent ID, email address, or any other attribute that uniquely identifies the user
    within your IdP.
  tags:
    - admin
    - authentication-settings
  security:
    - jwt: []
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          required: [enable, idp, sp]
          properties:
            enable:
              type: boolean
              description: |
                Specifies whether to activate (`true`) or deactivate (`false`) SAML authentication.
                If set to `false`, all other attributes will be ignored.
            idp:
              type: object
              description: |
                Configuration for the Identity Provider (IdP) that ShellHub will use for authentication. 
                You can provide either a metadata URL to fetch all necessary information automatically 
                or specify the `SignOn URL`, `Entity ID`, and `X509 certificate` explicitly.
              properties:
                metadata_url:
                  type: string
                  format: url
                  description: |
                    The URL to fetch IdP metadata. If provided, this will automatically retrieve
                    all necessary configuration details and take precedence over manually specified values.
                entity_id:
                  type: string
                  description: The Entity ID of the IdP.
                certificate:
                  type: string
                  description: |
                    The public X509 certificate of the IdP. It can be provided with or without 
                    the PEM delimiters (`-----BEGIN CERTIFICATE-----` and `-----END CERTIFICATE-----`).
                binding:
                  type: object
                  description: |
                    Configuration for SAML binding methods that define how authentication requests 
                    and responses are transmitted between ShellHub and the IdP. SAML supports 
                    different binding protocols for flexibility in deployment scenarios.
                  properties:
                    post:
                      type: string
                      format: url
                      description: |
                        The Single Sign-On URL for HTTP-POST binding. This URL is where ShellHub 
                        will redirect users for authentication using the HTTP-POST method, which 
                        sends SAML data in the body of an HTTP POST request. This binding is more 
                        secure as it doesn't expose SAML data in URL parameters.
                    redirect:
                      type: string
                      format: url
                      description: |
                        The Single Sign-On URL for HTTP-Redirect binding. This URL is where ShellHub 
                        will redirect users for authentication using the HTTP-Redirect method, which 
                        sends SAML data as URL parameters. This binding is simpler but has URL length 
                        limitations and exposes SAML data in browser history and server logs.
                    preferred:
                      type: string
                      enum: [post, redirect]
                      description: |
                        Specifies which binding method ShellHub should prefer when both POST and 
                        Redirect bindings are available. If only one binding URL is provided, 
                        that binding will be used regardless of this preference setting. If left
                        blank or empty, POST binding is preferred by default.
                mappings:
                  type: object
                  description: |
                    Defines how SAML attributes from the IdP should be mapped
                    to ShellHub user attributes.
                  properties:
                    email:
                      type: string
                      description: |
                        The name of the SAML attribute that contains the user's email address.
                        This attribute will be used to identify and authenticate users in ShellHub.
                        For example, if your IdP sends the email in a SAML attribute named "mail",
                        set this value to "mail".
                      default: emailAddress
                    name:
                      type: string
                      description: |
                        The name of the SAML attribute that contains the user's display name.
                        This attribute will be used as the user's name in ShellHub.
                        For example, if your IdP sends the user's name in a SAML attribute 
                        named "displayName", set this value to "displayName".
                      default: displayName
            sp:
              type: object
              description: Configuration settings for how ShellHub will function as a Service Provider (SP).
              properties:
                sign_requests:
                  type: boolean
                  description: |
                    Indicates whether ShellHub should sign authentication requests. 
                    If `true`, ShellHub will generate a public X509 certificate that must be deployed on the IdP for validation. 
                    The IdP-initiated workflow is not supported when this option is enabled.
  responses:
    '200':
      $ref: '../components/responses/200.yaml'
    '400':
      $ref: '../components/responses/400.yaml'
    '401':
      $ref: '../components/responses/401.yaml'
    '500':
      $ref: '../components/responses/500.yaml'
